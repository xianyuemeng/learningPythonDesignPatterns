11.2 软件开发反模式
===

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当应用程序或项目进入软件开发阶段时，就需要考虑代码结构了。这种结构需要与产品架构、设计、客户使用案例以及许多其他开发考虑因素保持一致。

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通常情况下，在进行软件开发时，往往会偏离最初的代码结构，原因如下。
* 开发人员的想法会随着开发过程的推进而发生变化；
* 用例通常会随着客户的反馈而进行更改；
* 最初设计的数据结构可能会随功能或可伸缩性等方面的考虑而发生变化。

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;基于上述原因，软件通常需要进行重构。虽然重构带有许多负面含义，但实际上，重构是软件开发过程的关键部分之一，为开发人员提供了一个机会来重新评估数据结构，并重新审视可扩展性和不断变化的客户需求。

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;下面，我们将列举软件开发和架构中的几种反模式，并简要介绍其原因、症状和后果。

> ## 11.2.1　意大利面条式代码

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这是软件开发中最“喜闻乐见”的反模式。你见过意大利面吗？太错综复杂了,不是吗？如果以特殊的方式开发结构，软件控制流也会变得错综复杂。意大利面条式代码是非常难以维护和优化的。

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;意大利面条式代码的典型成因包括：

* 对面向对象编程和分析的无知；
* 没有考虑产品的架构或设计；
* 快餐式思维。

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当你遭遇意大利面条式代码时，就会面临下列问题：
* 结构的重用性将会降到最低；
* 维护工作量过高；
* 进行修改时，扩展性和灵活性会降低。

> ## 11.2.2　金锤

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在软件行业，你会见到这样的情况：由于某个解决方案（技术、设计或模块）在多个项目中效果不错，所以就把它推广到更多的地方。正如我们在本书中看到的各种例子一样，如果一个解决方案非常适合某种特定场景，那么就可以用来解决这种类型的问题。然而，团队或软件开发人员通常会有这样一种倾向：一头扎进一个成熟的解决方案，而不管其是否满足适用性。这就是“金锤”这个名称的由来，意思是一把锤子搞定所有的钉子（解决所有问题）。

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;之所以出现金锤，典型的原因有如下几个：

* 来自不了解具体问题的高层（架构师或技术领袖）的建议；
* 虽然某解决方案在过去多次验证有效，但当前项目却具有不同的背景和要求；
* 公司已经被这种技术“绑架”了，因为他们已经在它上面投资了大量资金来培训员工，或员工们对这种技术情有独钟，因为已经用顺手了。

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;金锤的影响如下所示：

* 痴迷于一个解决方案，并把它应用于所有软件项目；
* 不是通过功能，而是通过开发中使用的技术来描述产品；
* 你会在公司走廊中听到开发人员说“怎么可能比这个解决方案更好呢”；
* 没有满足需求，造成与用户的预期不符。

> ## 11.2.3　熔岩流

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这个反模式与软件应用程序中的死代码或一段用不到的代码有关，并且，人们害怕一旦对其进行修改，就会破坏其他东西。随着时间的流逝，这段代码会一直留在软件中并固化其位置，就像熔岩变成硬岩一样。它常见于这样的情形中：开发的软件是用来支持某个用例的，刚开始并没有什么问题，但如果用例本身会随时间变化的话，那么这个问题就迎面而来了。

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;熔岩流的成因包括以下几个：
* 在产品中有大量的试错代码；
* 由一个人单独编写的代码，未经审查，就在没有任何培训的情况下移交给了其他开发团队；
* 软件架构或设计的初始思想是通过代码库实现的，但没有人能理解它。

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;熔岩流的症状如下：
* 开发的测试工作（如果完成的话）具有很低的代码覆盖率；
* 代码中含有莫名奇妙的注释；
* 过时的接口，或开发人员需要围绕既有代码展开工作。

> ## 11.2.4　复制粘贴或剪切粘贴式编程

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;正如你所知，这是最常见的反模式之一。许多经验丰富的开发人员会将自己的代码片段放到网络上面（GitHub或Stack Overflow），从而为一些常见问题提供相应的解决方案。有些开发人员为了提高开发进度，经常会原封不动地复制这些片段，并用于自己的应用程序中。在这种情况下，根本没有考虑这些代码是否经过了最大程度的优化，甚至连是否真正适合当前的场景都无法确保。这将导致开发的软件应用程序缺乏灵活性，同时变得难以维护。

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;导致复制粘贴或剪切粘贴式编程的原因如下：
* 新手开发者不习惯编写代码或不知道如何开发代码；
* 快速修复bug或“急就章”式的开发；
* 代码重复，无法满足跨模块标准化以及代码结构化的要求；
* 缺乏长远打算或深谋远虑。

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;剪切粘贴或复制粘贴式编程的后果包括：
* 多个软件应用程序存在同种类型的问题；
* 维护成本会更高，同时bug的生命周期也会变得更长；
* 较少的模块化代码库，相同的代码会散落于多处；
* 继承问题。
